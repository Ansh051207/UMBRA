{"ast":null,"code":"var _jsxFileName = \"/Users/anshagrawal/Desktop/umb/frontend/src/contexts/AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useState, useContext, useEffect } from 'react';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\nconst AuthContext = /*#__PURE__*/createContext();\nexport const useAuth = () => {\n  _s();\n  return useContext(AuthContext);\n};\n_s(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const AuthProvider = ({\n  children\n}) => {\n  _s2();\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      fetchUser();\n    } else {\n      setLoading(false);\n    }\n  }, []);\n  const fetchUser = async () => {\n    try {\n      const response = await axios.get(`${API_URL}/auth/me`);\n      setUser(response.data.user);\n    } catch (error) {\n      console.error('Failed to fetch user:', error);\n      logout();\n    } finally {\n      setLoading(false);\n    }\n  };\n  const login = async (email, password) => {\n    try {\n      const response = await axios.post(`${API_URL}/auth/login`, {\n        email,\n        password\n      });\n      const {\n        token,\n        user\n      } = response.data;\n      localStorage.setItem('token', token);\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      setUser(user);\n      return {\n        success: true\n      };\n    } catch (error) {\n      var _error$response, _error$response$data;\n      return {\n        success: false,\n        error: ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.error) || 'Login failed'\n      };\n    }\n  };\n  const register = async userData => {\n    e.preventDefault();\n    setError('');\n\n    // Validation\n    if (!formData.username.trim()) {\n      setError('Username is required');\n      return;\n    }\n    if (!formData.email.includes('@') || !formData.email.includes('.')) {\n      setError('Please enter a valid email address');\n      return;\n    }\n    if (formData.password !== formData.confirmPassword) {\n      setError('Passwords do not match');\n      return;\n    }\n    if (formData.password.length < 6) {\n      setError('Password must be at least 6 characters');\n      return;\n    }\n    if (!masterPassword) {\n      setError('Please generate a master password');\n      return;\n    }\n    setLoading(true);\n    try {\n      console.log('Starting registration process...');\n\n      // Generate RSA key pair (simplified for now)\n      const keyPair = {\n        publicKey: `pub_${Math.random().toString(36).substring(2)}_${Date.now()}`,\n        privateKey: `priv_${Math.random().toString(36).substring(2)}_${Date.now()}`\n      };\n      console.log('Generated key pair');\n\n      // Simple encryption for private key\n      const salt = generatePassword(16);\n      const derivedKey = hashPassword(masterPassword, salt);\n      const encryptedPrivateKey = JSON.stringify({\n        ciphertext: btoa(keyPair.privateKey),\n        // Simple base64 encoding for now\n        salt: salt\n      });\n      console.log('Prepared user data');\n\n      // Prepare registration data\n      const userData = {\n        username: formData.username.trim(),\n        email: formData.email.trim(),\n        password: formData.password,\n        publicKey: keyPair.publicKey,\n        encryptedPrivateKey: encryptedPrivateKey\n      };\n      console.log('Sending registration request:', {\n        username: userData.username,\n        email: userData.email,\n        hasPassword: !!userData.password,\n        hasPublicKey: !!userData.publicKey\n      });\n      const result = await register(userData);\n      if (result.success) {\n        console.log('Registration successful');\n        // Show master password to user\n        alert(`IMPORTANT: Save this master password securely. You will need it to access your notes:\\n\\n${masterPassword}\\n\\nWe recommend saving it in a password manager.`);\n        navigate('/');\n      } else {\n        console.error('Registration failed:', result.error);\n        setError(result.error || 'Registration failed. Please try again.');\n      }\n    } catch (error) {\n      console.error('Registration error:', error);\n      setError(`Registration failed: ${error.message}`);\n    } finally {\n      setLoading(false);\n    }\n  };\n  const logout = () => {\n    localStorage.removeItem('token');\n    delete axios.defaults.headers.common['Authorization'];\n    setUser(null);\n  };\n  const value = {\n    user,\n    loading,\n    login,\n    register,\n    logout,\n    isAuthenticated: !!user\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 158,\n    columnNumber: 5\n  }, this);\n};\n_s2(AuthProvider, \"NiO5z6JIqzX62LS5UWDgIqbZYyY=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","axios","jsxDEV","_jsxDEV","API_URL","process","env","REACT_APP_API_URL","AuthContext","useAuth","_s","AuthProvider","children","_s2","user","setUser","loading","setLoading","token","localStorage","getItem","defaults","headers","common","fetchUser","response","get","data","error","console","logout","login","email","password","post","setItem","success","_error$response","_error$response$data","register","userData","e","preventDefault","setError","formData","username","trim","includes","confirmPassword","length","masterPassword","log","keyPair","publicKey","Math","random","toString","substring","Date","now","privateKey","salt","generatePassword","derivedKey","hashPassword","encryptedPrivateKey","JSON","stringify","ciphertext","btoa","hasPassword","hasPublicKey","result","alert","navigate","message","removeItem","value","isAuthenticated","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/anshagrawal/Desktop/umb/frontend/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\nimport axios from 'axios';\n\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\n\nconst AuthContext = createContext();\n\nexport const useAuth = () => useContext(AuthContext);\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      fetchUser();\n    } else {\n      setLoading(false);\n    }\n  }, []);\n\n  const fetchUser = async () => {\n    try {\n      const response = await axios.get(`${API_URL}/auth/me`);\n      setUser(response.data.user);\n    } catch (error) {\n      console.error('Failed to fetch user:', error);\n      logout();\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const login = async (email, password) => {\n    try {\n      const response = await axios.post(`${API_URL}/auth/login`, { email, password });\n      const { token, user } = response.data;\n      \n      localStorage.setItem('token', token);\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      setUser(user);\n      \n      return { success: true };\n    } catch (error) {\n      return { \n        success: false, \n        error: error.response?.data?.error || 'Login failed' \n      };\n    }\n  };\n\n  const register = async (userData) => {\n   e.preventDefault();\n  setError('');\n\n  // Validation\n  if (!formData.username.trim()) {\n    setError('Username is required');\n    return;\n  }\n\n  if (!formData.email.includes('@') || !formData.email.includes('.')) {\n    setError('Please enter a valid email address');\n    return;\n  }\n\n  if (formData.password !== formData.confirmPassword) {\n    setError('Passwords do not match');\n    return;\n  }\n\n  if (formData.password.length < 6) {\n    setError('Password must be at least 6 characters');\n    return;\n  }\n\n  if (!masterPassword) {\n    setError('Please generate a master password');\n    return;\n  }\n\n  setLoading(true);\n\n  try {\n    console.log('Starting registration process...');\n    \n    // Generate RSA key pair (simplified for now)\n    const keyPair = {\n      publicKey: `pub_${Math.random().toString(36).substring(2)}_${Date.now()}`,\n      privateKey: `priv_${Math.random().toString(36).substring(2)}_${Date.now()}`\n    };\n    \n    console.log('Generated key pair');\n    \n    // Simple encryption for private key\n    const salt = generatePassword(16);\n    const derivedKey = hashPassword(masterPassword, salt);\n    const encryptedPrivateKey = JSON.stringify({\n      ciphertext: btoa(keyPair.privateKey), // Simple base64 encoding for now\n      salt: salt\n    });\n\n    console.log('Prepared user data');\n    \n    // Prepare registration data\n    const userData = {\n      username: formData.username.trim(),\n      email: formData.email.trim(),\n      password: formData.password,\n      publicKey: keyPair.publicKey,\n      encryptedPrivateKey: encryptedPrivateKey\n    };\n\n    console.log('Sending registration request:', {\n      username: userData.username,\n      email: userData.email,\n      hasPassword: !!userData.password,\n      hasPublicKey: !!userData.publicKey\n    });\n\n    const result = await register(userData);\n    \n    if (result.success) {\n      console.log('Registration successful');\n      // Show master password to user\n      alert(`IMPORTANT: Save this master password securely. You will need it to access your notes:\\n\\n${masterPassword}\\n\\nWe recommend saving it in a password manager.`);\n      navigate('/');\n    } else {\n      console.error('Registration failed:', result.error);\n      setError(result.error || 'Registration failed. Please try again.');\n    }\n  } catch (error) {\n    console.error('Registration error:', error);\n    setError(`Registration failed: ${error.message}`);\n  } finally {\n    setLoading(false);\n  }\n  };\n\n  const logout = () => {\n    localStorage.removeItem('token');\n    delete axios.defaults.headers.common['Authorization'];\n    setUser(null);\n  };\n\n  const value = {\n    user,\n    loading,\n    login,\n    register,\n    logout,\n    isAuthenticated: !!user\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}